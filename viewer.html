<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PDF Viewer</title>

  <!-- PDF.js v5 viewer styles -->
  <link rel="stylesheet" href="pdfjs/viewer.css">
</head>
<body>

  <!-- PDF.js viewer container -->
  <div id="viewerContainer" class="pdfViewer"></div>

  <!-- PDF.js v5 viewer module -->
  <script type="module">
    import * as pdfjsViewer from './pdfjs/viewer.mjs';
    import * as pdfjsLib from './pdfjs/pdf.mjs';

    // PDF.js worker のパス設定
    pdfjsLib.GlobalWorkerOptions.workerSrc = './pdfjs/pdf.worker.mjs';

    // URL パラメータから PDF ファイル名とページ番号を取得
    const urlParams = new URLSearchParams(window.location.search);
    const file = urlParams.get("file");
    const pageNumber = parseInt(urlParams.get("page") || "1");

    if (!file) {
      document.body.innerHTML = "<p>file パラメータが必要です。</p>";
      throw new Error("file パラメータが必要です");
    }

    const pdfUrl = file;

    // PDFの読み込み
    const eventBus = new pdfjsViewer.EventBus();
    const linkService = new pdfjsViewer.PDFLinkService({ eventBus });

    const viewer = new pdfjsViewer.PDFViewer({
      container: document.getElementById("viewerContainer"),
      eventBus,
      linkService
    });

    linkService.setViewer(viewer);

    const loadingTask = pdfjsLib.getDocument(pdfUrl);

    loadingTask.promise.then(pdfDocument => {
      viewer.setDocument(pdfDocument);
      linkService.setDocument(pdfDocument);

      // 指定ページへ移動
      viewer.currentPageNumber = pageNumber;
    });
  </script>

</body>
</html>
